!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var a=e();for(var n in a)("object"==typeof exports?exports:t)[n]=a[n]}}(this,function(){return webpackJsonp([55],{1361:function(t,e,a){"use strict";var n=a(401),i=a.n(n),o=a(27),r=a.n(o),s=a(86),l=a(1362),d=a.n(l),c=a(1363),u=a(848),h=a(850),p=a(1366),g=a(323),f=a(22),m=a(4),v=a(157),_={APICore1_0:u.a,APICore1_2:h.a,APICore1_3:p.a},M=function(t,e){return new _[t](e)},y=function(t){this._definitions={},this._instance=void 0,this._instanceId=t,this._name=void 0,this._parentDomain=this.getMessageTargetDomain(document.referrer),this._defer=new s.a};y.create=function(t,e,a,n){var i;if(e){var o=e;i=new y(t);var s=d.a[e];if(!s){var l=r()(d.a),u=l[l.length-1];s=d.a[u],console.warn("you requested api version "+e+" but this version is not available. Returned api version "+u+" instead"),o=u}var h=M("APICore"+s.ApiCoreVersion,a);i.register(o,s,h)}else i=new c.a,i.initialize(a,n),console.warn("you are using a deprecated api, please update to the new one, read mode xxxx");return i},y.prototype={ready:function(){if(window.parent){var t=Object(f.a)().apiHookEnv;if(void 0!==t){if(m.a.me().get("isStaff")){var e=new XMLHttpRequest,a=function(t){if(e.readyState===XMLHttpRequest.DONE){var a=JSON.parse(t.target.response);if(a.domain){var n=a.domain;if(n!==window.location.hostname){var i={type:"api.ready",instanceId:this._instanceId,results:[this._instanceId],options:{domain:n}};return void window.parent.postMessage(i,this._parentDomain)}}}}.bind(this);e.addEventListener("load",a),e.open("GET","/i/users/viewer-api/authorized-domains?domain="+t);var n=document.cookie.match(new RegExp("sb_csrftoken=([^;]+)"));n||console.error("CRSF cookie missing");var i=n[1];e.setRequestHeader("X-CSRFToken",i),e.send()}}var o={type:"api.ready",instanceId:this._instanceId,results:[this._instanceId]};Object(g.a)()||(o.error="No Hardware Support for Webgl"),window.parent.postMessage(o,this._parentDomain)}},clientReady:function(){return this._defer.promise},register:function(t,e,a){this._name=t,this._members=r()(e),this._membersMapping=e,this._instance=a,this.init()},getViewerAPI:function(){return this._instance},getMessageTargetDomain:function(t){if(!t||!t.length)return"*";if(window.location.href.split("?")[0]===t.split("?")[0]){var e="Embed With Wrong options: "+t;return v.a.client.captureMessage(e),console.warn(e),"*"}var a=t.split("//");return a[0]+"//"+a[1].split("/")[0]},init:function(){this._defer.resolve();var t=["api.initialize","api.request"],e=i()(this._instance);window.addEventListener("message",function(a){if((a.origin===this._parentDomain||"*"===this._parentDomain)&&a.data&&a.data.type){var n=a.data.type;if(-1!==t.indexOf(n)){var i="api.initialize"!==n;if(!i||a.data.instanceId&&a.data.instanceId===this._instanceId)try{if(i&&this._instanceId!==a.data.instanceId)throw"Invalid request : instance does not exists";if("api.request"===a.data.type){var o=this._membersMapping[a.data.member];if("-"===o&&(o=a.data.member),!o||!e[o])throw"Invalid request : member function does not exists: "+o;if("function"!=typeof e[o])throw"Invalid request : member function does not exists: "+o;for(var r=e[o],s=a.data.arguments.slice(),l=s.length-1;l>=0&&void 0===s[l];l--)s.splice(l,1);return r.length&&"function"==typeof s[r.length-1]&&(s.length=r.length-1),s.push(function(){a.source.postMessage({type:"api.request.result",instanceId:this._instanceId,requestId:a.data.requestId,results:Array.prototype.slice.call(arguments)},this._parentDomain)}.bind(this)),void r.apply(this._instance,s)}if("api.initialize"===a.data.type){if(this._name!==a.data.name)throw"No API named '"+a.data.name+"'";var d=this._members,c=this._instance;if(void 0!==c.addGlobalListener){var u=function(){var t={type:"api.event",instanceId:this._instanceId,results:Array.prototype.slice.call(arguments)};a.source.postMessage(t,this._parentDomain)}.bind(this);c.addGlobalListener(u)}return void a.source.postMessage({type:"api.initialize.result",instanceId:this._instanceId,requestId:a.data.requestId,results:[null,this._instanceId,d]},this._parentDomain)}}catch(t){console.error(t),a.source.postMessage({type:n+".result",instanceId:this._instanceId,requestId:a.data.requestId,results:[t.stack?t.stack:t]},this._parentDomain)}}}}.bind(this))}},e.a=y},1362:function(t,e,a){var n=a(0).extend,i={ApiCoreVersion:"1_0",start:"-",stop:"-",load:"-",gotoAnnotation:"-",getAnnotationList:"-",lookat:"-",setFov:"-",getCurrentTime:"-",play:"-",pause:"-",seekTo:"-",getAnimations:"-",setCurrentAnimationByUID:"-",setCycleMode:"-",setSpeed:"-",getSceneGraph:"-",getNodeMap:"-",getMatrix:"-",setMatrix:"-",hide:"-",show:"-",translate:"-",rotate:"-",getRootMatrixNode:"-",getCameraLookAt:"-",setCameraLookAt:"-",getScreenShot:"-",getMaterialList:"-",getTextureList:"-",addTexture:"-",updateTexture:"-",setTextureQuality:"-",setMaterial:"-",setPostProcessing:"-",getPostProcessing:"-"},o=n({},i,{getWorldToScreenCoordinates:"-"}),r=n({},o,{ApiCoreVersion:"1_2",pickColor:"-",setListenerOptions:"-",unselectAnnotation:"-"}),s=n({},r,{ApiCoreVersion:"1_3",setCameraEasing:"-",showAnnotation:"-",hideAnnotation:"-",getAnnotation:"-",updateAnnotation:"-",createAnnotation:"-",removeAnnotation:"-",pickFromScene:"-",pickFromScreen:"-",addVideoTexture:"-",translate:"-",rotate:"-"}),l=n({},s,{});t.exports={"1.0.0":i,"1.0.1":i,"1.0.2":i,"1.0.3":i,"1.1.0":o,"1.2.0":r,"1.2.1":r,"1.3.0":s,"1.3.1":l}},1363:function(t,e,a){"use strict";var n=a(5),i=a.n(n),o=function(){return{_viewer:void 0,version:"0.2",initialize:function(t,e){this._viewer=t,this._uid=e;var a=this;window.addEventListener("message",function(t){if(t.data&&t.data.command){var e=t.data;"initialize"!==e.command&&Object.prototype.hasOwnProperty.call(a,e.command)&&a[e.command].call(a,e)}},!1)},ready:function(){this.answer({status:"load"})},clientReady:function(){return i.a.resolve()},answer:function(t){t.source=this._uid,void 0!==window.parent&&window.parent.postMessage(t,"*")},start:function(){this._viewer.start(),this.answer({status:"start"})},stop:function(){this._viewer.stop(),this.answer({status:"stop"})},lookat:function(t){this._viewer.lookat&&(this._viewer.lookat(t.eye,t.target,t.duration),window.setTimeout(function(){this.answer({status:"lookat"})}.bind(this),1e3*t.duration),this.answer({status:"lookat start"}))},autospin:function(t){!1===t&&(t=0),this.answer({status:"autospin"})},getViewerAPI:function(){}}};e.a=o},1364:function(t,e,a){"use strict";var n=a(8),i=n.a.osg,o=function(){i.NodeVisitor.apply(this,arguments),this.reset()};i.createPrototypeObject(o,i.objectInherit(i.NodeVisitor.prototype,{reset:function(){this._nodes=[],this._nodeMap={},this._nodeList={},this._dirty=!0},isDirty:function(){return this._dirty},getRootNode:function(){return this._nodes[0]},getRealNodeMap:function(){return this._nodeList},getRepresentationNodeMap:function(){return this._nodeMap},createNodeEntry:function(t){this._dirty=!1;var e=t.getInstanceID();this._nodeList[e]||(this._nodeList[e]=t);var a={name:t.getName(),instanceID:e,nodeMask:t.getNodeMask()};return this._nodeMap[e]||(this._nodeMap[e]=a),a},applyNode:function(t){var e=this._nodes;this._nodes=[],this.traverse(t);var a=this.createNodeEntry(t);a.children=this._nodes,a.type="Group",e.push(a),this._nodes=e},applyMatrixTransform:function(t){var e=this._nodes;this._nodes=[],this.traverse(t);var a=this.createNodeEntry(t);a.children=this._nodes,a.type="MatrixTransform",a.localMatrix=i.mat4.clone(t.getMatrix()),a.worldMatrix=t.getWorldMatrices()[0],e.push(a),this._nodes=e},applyGeometry:function(t){var e=this._nodes;this._nodes=[],this.traverse(t);var a=this.createNodeEntry(t);a.type=t.className(),e.push(a),this._nodes=e},apply:function(t){var e=t.getTypeID();e===i.Node.typeID?this.applyNode(t):e===i.MatrixTransform.typeID?this.applyMatrixTransform(t):t instanceof i.Geometry?this.applyGeometry(t):this.traverse(t)}})),e.a=o},1365:function(t,e,a){"use strict";function n(){this.handlers=[],this.events=[]}n.prototype={subscribe:function(t){this.events.forEach(function(e){t(e.name,e.args)});var e=this.handlers.push(t);return function(){this.handlers.split(e-1,1)}},emit:function(t,e){this.events.push({name:t,args:e}),this.handlers.forEach(function(a){a(t,e)})}},e.a=n},1366:function(t,e,a){"use strict";var n=a(8),i=a(850),o=a(150),r=a(81),s=a(0),l=(a.n(s),a(849)),d=a(47),c=a(18),u=n.a.osg,h=n.a.osgAnimation,p=function(){i.a.apply(this,arguments),this.updateDaemon=void 0};p.prototype=Object(s.create)(i.a.prototype,{setCameraEasing:function(t){this._getFeatureModel("camera").set("easingFunction",t)},hideAnnotation:function(t,e){this._getFeatureModel("hotspot").get("hotspots").at(t).set("visible",!1),e(null)},showAnnotation:function(t,e){this._getFeatureModel("hotspot").get("hotspots").at(t).set("visible",!0),e(null)},createAnnotation:function(t,e,a,n,i,r,s){var l=o.a.computeNearestIntersection3D(t,e);if(!l)return s(null);var d=this._getFeatureModel("hotspot"),u=d.createHotspot(l,!0);c.a.getMarkdownPreview(r).then(function(t){u.set({name:i,content:{raw:r,rendered:t.result},eye:a,target:n}),s(null,d.get("hotspots").length-1)},function(){u.set({name:i,eye:a,target:n}),s(null,d.get("hotspots").length-1)}.bind(this))},updateAnnotation:function(t){var e,a=this._getFeatureModel("hotspot").get("hotspots"),n=a.at(t);if(3===arguments.length){var i=arguments[1],o={};if(i.title&&(o.name=i.title),i.content&&(o.content={raw:i.content}),i.eye&&(o.eye=i.eye),i.target&&(o.target=i.target),e=arguments[2],i.content)return void c.a.getMarkdownPreview(i.content).then(function(t){o.content.rendered=t.result;var a=n.toJSON();this._filterAnnotationModelMessage(a),e(null,a),n.set(o)}.bind(this),function(){var t=n.toJSON();this._filterAnnotationModelMessage(t),e(null,t),n.set(o)}.bind(this));n.set(o)}else e=arguments[1];var r=n.toJSON();this._filterAnnotationModelMessage(r),e(null,r)},getAnnotation:function(t,e){var a=this._getFeatureModel("hotspot").get("hotspots"),n=a.at(t),i=n.toJSON();this._filterAnnotationModelMessage(i),e(null,i)},removeAnnotation:function(t,e){var a=this._getFeatureModel("hotspot").get("hotspots"),n=a.at(t);a.remove(n),e(null)},pickFromScreen:function(){var t=u.vec3.create(),e=u.vec3.create();return function(a,n){var i=o.a.computeNearestIntersection2D(a[0],a[1],this._pickMask.click);i||n(null),o.a.getWorldPositionFromHit(i,e,t);var r=i._nodePath[i._nodePath.length-1].getInstanceID(),s=this._getFeatureModel("material"),l=s.findFirstMaterial(i._nodePath);n(null,{position3D:e,position2D:a,normal:t,instanceID:r,material:l})}}(),pickFromScene:function(){var t=u.vec3.create(),e=u.vec3.create();return function(a,n,i){var r=o.a.computeNearestIntersection3D(a,n);if(!r)return i(null);o.a.getWorldPositionFromHit(r,e,t);var s=r._nodePath[r._nodePath.length-1].getInstanceID(),l=this._getFeatureModel("material"),d=l.findFirstMaterial(r._nodePath);i(null,{position3D:e,normal:t,instanceID:s,material:d})}}(),addVideoTexture:function(t,e,a){this._convertVideoDataUriToImage(t,void 0,e,a)},_convertVideoDataUriToImage:function(t,e,a,n){var i=this._getFeatureModel("material").getImageCollection();r.default.instance.getOrCreateImage(t).promise.then(function(o){var r=i.addNewImage({uid:e,url:t,width:o.getWidth(),height:o.getHeight(),name:t.slice(0,100)});void 0!==a&&o.getImage&&(o.getImage().loop=a),n(null,r.getUID())}).catch(function(){n("failed to add texture")})},translate:function(t,e,a){var n=arguments.length,i=arguments[n-1],o=0,r=h.easeOutQuad;n>2&&(a=arguments[2],a.duration&&(o=a.duration),a.easing&&h[a.easing]&&(r=h[a.easing]));var s=this._getRealNodeMap(),c=s[t];if(c.getTypeID()!==u.MatrixTransform.typeID)return void i("you can only translate MatrixTransform nodes");if(o>0){var p=u.vec3.create();u.mat4.getTranslation(p,c.getMatrix());var g=new l.c(p,e,o,r,function(e){this.updateDaemon.removeTranslateUpdateCallback(t),i(null,e)}.bind(this));this.updateDaemon||this._initUpdateDaemon(s),this.updateDaemon.addTranslateUpdateCallback(c,g,t)}else u.mat4.setTranslation(c.getMatrix(),e),c.dirtyBound(),i(null,e);d.a.redrawShadow()},rotate:function(){var t=u.vec3.create(),e=u.vec3.create();return function(a,n,i){var o=arguments.length,r=arguments[o-1],s=0,c=h.easeOutQuad;o>2&&(i=arguments[2],i.duration&&(s=i.duration),i.easing&&h[i.easing]&&(c=h[i.easing]));var p=this._getRealNodeMap();if(p[a].getTypeID()!==u.MatrixTransform.typeID)return void r("you can only rotate MatrixTransform nodes");var g=u.quat.create(),f=u.mat4.create();u.mat4.fromRotation(f,-n[0],u.vec3.set(e,n[1],n[2],n[3])),u.mat4.getRotation(g,f);var m=p[a];if(s>0){var v=u.quat.create();u.mat4.getRotation(v,m.getMatrix());var _=new l.a(v,g,s,c,function(t){this.updateDaemon.removeRotateUpdateCallback(a),r(null,t)}.bind(this));this.updateDaemon||this._initUpdateDaemon(p),this.updateDaemon.addRotateUpdateCallback(m,_,a)}else u.mat4.fromQuat(f,g),u.mat4.getTranslation(t,m.getMatrix()),u.mat4.setTranslation(f,t),u.mat4.copy(m.getMatrix(),f),m.dirtyBound(),r(null,n);d.a.redrawShadow()}}(),_initUpdateDaemon:function(t){var e=this._getViewer().getRootModel();this.updateDaemon=new l.b(t),e.addUpdateCallback(this.updateDaemon)}}),e.a=p},1377:function(t,e,a){"use strict";var n=a(86),i=new n.a;e.a={resolve:function(t){i.resolve(t)},get:function(){return i},then:i.then.bind(i)}},1686:function(t,e,a){t.exports=a(1687)},1687:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=(a(325),a(3)),i=a.n(n),o=a(5),r=a.n(o),s=a(715),l=a(22),d=a(1361),c=a(714),u=a(326),h=a(1377),p=a(847),g=a(157),f=a(293);r.a.config({warnings:!1,longStackTraces:!1,cancellation:!0,monitoring:!1}),Object(u.a)(),Object(p.a)(),Object(f.a)(),document.addEventListener("DOMContentLoaded",function(){g.a.client.setTagsContext({frontend:"3d"});var t=i()(".viewer"),e=t.find("[data-modeluid]").attr("data-modeluid");if(e=Object(l.a)().model||e){t.addClass("started");var a=new s.a({el:t});h.a.resolve(a);var n,o=Object(l.a)().apiVersion;o&&(n=d.a.create(Object(l.a)().apiId,o,a,e)),a.setScene({uid:e,features:c.a}),n?(n.ready(),n.clientReady().then(function(){a.start(!0)})):a.start(!0),g.a.client.setTagsContext({frontend:"web"})}})},847:function(t,e,a){"use strict";var n=a(5),i=a.n(n),o=a(25),r=a.n(o),s=a(20),l=a(59),d=a(14),c=a(22),u=a(355),h=function(){if("dev"!==d.a.buildMode){var t=!1;if(d.a.prodHookDomainsBlacklist.forEach(function(e){document.location.href.indexOf(e)>-1&&(t=!0)}),t)return}if(-1!==window.location.search.substr(1).indexOf("hook_")){for(var e,a="hook_".length,n=window.location.search.substr(1).split(/&+/g),i=0;i<n.length;++i){var o=n[i];if(-1!==o.indexOf("hook_")){e=o.substr(a,o.indexOf("=")-a);break}}if(e&&s.b.bool("hook_"+e)){var r="https://";return r+="prod"===e?"sketchfab.com":"fatvoxel"===e?"fatvoxel.com":e+".fatvoxel.com"}}},p=function(t,e){var a=new r.a.Model;return a.url=t+e,a.fetch().then(function(t){return window.prefetchedData[e]=t,t})},g=function(t,e){for(var a=["","animations","backgrounds","environments","hotspots","matcaps","sounds","textures"],n=[],o=0;o<a.length;++o){var r=Object(u.a)(a[o],e);n.push(p(t,r))}return i.a.all(n).then(function(t){return new l.a(t[0])})},f=function(){var t=h();if(t){var e=Object(c.a)().model;if(e){var a=g(t,e);l.a.get=function(){return a}}}};e.a=f},848:function(t,e,a){"use strict";var n=a(8),i=a(0),o=(a.n(i),a(1364)),r=a(81),s=a(47),l=a(1365),d=a(849),c=a(150),u=a(432),h=n.a.osg,p=n.a.osgAnimation,g=function(t){this._partial=t,this._events={},this._replayEmitter=new l.a,this._partial.on("model-loaded",function(){this._emitEvents()}.bind(this)),this._sceneGraphVisitor=new o.a,this._nodeMap=void 0};g.prototype={_filterAnnotationModelMessage:function(t){delete t.refreshAction,delete t.sticky},addGlobalListener:function(t){this._replayEmitter.subscribe(t)},intersectPoint:function(t,e,a,n){var i=this._getFeatureModel("material"),o=i.findFirstMaterial(t._nodePath);this._replayEmitter.emit("click",{position3D:e,position2D:a,normal:n,instanceID:t._nodePath[t._nodePath.length-1].getInstanceID(),material:o?o.getJSON():null})},_getFeatureModel:function(t){var e=this._partial.scene.getFeatures()[t];if(e)return e.getModel()},_getViewerOSG:function(){return this._getViewer()._viewer},_getViewer:function(){return this._partial.scene},_emitEvents:function(){var t=["viewerready","annotationFocus","annotationBlur","click"];this._partial.scene.on("all",function(e,a){-1!==t.indexOf(e)&&this._replayEmitter.emit(e,a)}.bind(this)),this.emitEvents=function(){}},_computeSceneGraph:function(){var t=this._sceneGraphVisitor;t.isDirty()&&this._getViewer().getRootModel().accept(t)},_getRootNode:function(){return this._computeSceneGraph(),this._sceneGraphVisitor.getRootNode()},_getRealNodeMap:function(){return this._computeSceneGraph(),this._sceneGraphVisitor.getRealNodeMap()},_getRepresentationNodeMap:function(){return this._computeSceneGraph(),this._sceneGraphVisitor.getRepresentationNodeMap()},_convertDataUriToImage:function(t,e,a){var n=this._getFeatureModel("material").getImageCollection();r.default.instance.getOrCreateImage(t).promise.then(function(i){var o=n.addNewImage({uid:e,url:t,width:i.getWidth(),height:i.getHeight(),name:t.slice(0,100)});a(null,o.getUID())}).catch(function(){a("failed to add texture")})},start:function(t){this._partial.start(),t(null)},stop:function(t){this._partial.stop(),t(null)},load:function(t){this._partial.load(),t(null)},gotoAnnotation:function(t,e){var a=this._getFeatureModel("hotspot").get("hotspots"),n=a.at(t);a.trigger("select",n),e(null,t)},getAnnotationList:function(t){var e=this._getFeatureModel("hotspot"),a=e.get("hotspots"),n=a.toJSON();n.forEach(this._filterAnnotationModelMessage.bind(this)),t(null,n)},lookat:function(t,e,a,n){this.setCameraLookAt(t,e,a,n)},setFov:function(t,e){var a=this._getFeatureModel("camera"),n=a.setJSON({fov:t});e(n.length?n:null,t)},getCurrentTime:function(t){var e=this._getFeatureModel("animation"),a=e.getCurrentAnimation(),n=a.get("duration");t(null,e.get("progress")*n/100)},play:function(t){this._getFeatureModel("animation").set("playing",!0),t(null)},pause:function(t){var e=this._getFeatureModel("animation");if(!e)return void t("no animation feature");e.set("playing",!1),t(null)},seekTo:function(t,e){var a=this._getFeatureModel("animation"),n=a.getCurrentAnimation().get("duration"),i=100*t/n;a.trigger("seek",i),e(null)},getAnimations:function(t){var e=this._getFeatureModel("animation"),a=[];e.get("animations").forEach(function(t){var e=[];e.push(t.get("uid")),e.push(t.get("name")),e.push(t.get("duration")),a.push(e)}),t(null,a)},setCurrentAnimationByUID:function(t,e){this._getFeatureModel("animation").set("currentUID",t),e(null)},setCycleMode:function(t,e){var a=this._getFeatureModel("animation");1===a.get("animations").length&&"all"===t&&(t="one");var n=a.setJSON({cycleMode:t},{validate:!0,warnOnError:!0});e(n&&n.length?n:null)},setSpeed:function(t,e){var a=this._getFeatureModel("animation"),n=a.setJSON({speed:t},{validate:!0,warnOnError:!0});e(n&&n.length?n:null,t)},getSceneGraph:function(t){t(null,this._getRootNode())},getNodeMap:function(t){t(null,this._getRepresentationNodeMap())},getNodeMask:function(t,e){var a=this._getRealNodeMap(),n=a[t];n?e(null,n.getNodeMask()):e("node with id "+t.toString()+" not found")},getMatrix:function(t,e){var a=this._getRealNodeMap(),n=a[t];n?e(null,{local:n.getMatrix(),world:n.getWorldMatrices()[0]}):e("node with id "+t.toString()+" not found")},setMatrix:function(t,e,a){var n=this._getRealNodeMap(),i=n[t];h.mat4.copy(i.getMatrix(),e),i.dirtyBound(),a(null),s.a.redrawShadow()},hide:function(t,e){var a=this._getRealNodeMap(),n=a[t];n?(n.setNodeMask(0),e(null)):e("show: node id "+t+" not found"),s.a.redrawShadow()},show:function(t,e){var a=this._getRealNodeMap(),n=a[t];n?(n.setNodeMask(-1),e(null)):e("show: node id "+t+" not found"),s.a.redrawShadow()},translate:function(){var t,e,a=arguments.length,n=arguments[a-1],i=arguments[0],o=arguments[1];4===a?t=arguments[2]:5===a&&(t=arguments[2],e=arguments[3]),t=t||0;var r=p[e]||p.easeOutQuad,l=this._getRealNodeMap(),c=l[i];if(c.getTypeID()!==h.MatrixTransform.typeID)return void n("you can only translate MatrixTransform nodes");if(t>0){var u=h.vec3.create();h.mat4.getTranslation(u,c.getMatrix());var g=new d.c(u,o,t,r,function(t){c.removeUpdateCallback(g),n(null,t)});c.addUpdateCallback(g)}else h.mat4.setTranslation(c.getMatrix(),o),c.dirtyBound(),n(null,o);s.a.redrawShadow()},rotate:function(){var t=h.vec3.create(),e=h.vec3.create();return function(){var a,n,i=arguments.length,o=arguments[i-1],r=arguments[0],l=arguments[1];4===i?a=arguments[2]:5===i&&(a=arguments[2],n=arguments[3]),a=a||0;var c=p[n]||p.easeOutQuad,u=this._getRealNodeMap();if(u[r].getTypeID()!==h.MatrixTransform.typeID)return void o("you can only translate MatrixTransform nodes");var g=h.quat.create(),f=h.mat4.create();h.mat4.fromRotation(f,-l[0],h.vec3.set(e,l[1],l[2],l[3])),h.mat4.getRotation(g,f);var m=u[r];if(a>0){var v=h.quat.create();h.mat4.getRotation(v,m.getMatrix());var _=new d.a(v,g,a,c,function(t){m.removeUpdateCallback(_),o(null,t)});u[r].addUpdateCallback(_)}else h.mat4.fromQuat(f,g),h.mat4.getTranslation(t,m.getMatrix()),h.mat4.setTranslation(f,t),h.mat4.copy(m.getMatrix(),f),m.dirtyBound(),o(null,l);s.a.redrawShadow()}}(),getRootMatrixNode:function(t){var e=this._getViewer().getRootModel();if(e||t("No scene loaded"),!this._nodeInTheMiddle){this._nodeInTheMiddle=new h.MatrixTransform,this._nodeInTheMiddle.setName("NITM");for(var a=e.getChildren(),n=0,i=a.length;n<i;n++)this._nodeInTheMiddle.addChild(a[n]);e.removeChildren(),e.addChild(this._nodeInTheMiddle)}t(null,this._nodeInTheMiddle.getInstanceID(),this._nodeInTheMiddle.getMatrix())},getCameraLookAt:function(t){var e=this._getViewerOSG().getManipulator(),a=[],n=[];e.getTarget(a),e.getEyePosition(n),t(null,{position:n,target:a})},setCameraLookAt:function(t,e){var a=this._getFeatureModel("camera"),n=this._getViewerOSG().getManipulator(),i=arguments[arguments.length-1],o=3===arguments.length?2:arguments[2];o<=0?n.setTargetAndEye(e,t):(a.setTargetAndEye(e,t),a.set("animationDuration",o)),i(null)},getScreenShot:function(){var t,e,a=arguments.length,n=arguments[a-1],i="image/jpeg";if(2===a)i=arguments[0];else if(3===a)t=Math.floor(arguments[0]),e=Math.floor(arguments[1]);else if(4===a)t=Math.floor(arguments[0]),e=Math.floor(arguments[1]),i=arguments[2];else if(1!==a)return void n("Wrong number of arguments, signature should be (width, height, [callback]), (width, height, mimetype, [callback]), (mimetype, [callback]) or ([callback]).");n(null,this._getViewer().getScreenShot(t,e).toDataURL(i))},getMaterialList:function(t){var e=this._getFeatureModel("material");t(null,Object(i.values)(e.getJSON()))},getTextureList:function(t){t(null,this._getFeatureModel("material").getImageCollection().toJSON())},addTexture:function(t,e){this._convertDataUriToImage(t,void 0,e)},updateTexture:function(t,e,a){this._convertDataUriToImage(t,e,function(t){if(t)return void a(t);var n=this._getFeatureModel("material").getMaterials();for(var i in n){var o=n[i],r=o.getChannels();for(var s in r){var l=r[s],d=l.getTextureModel();d&&d.getUID()===e&&l.trigger("updateChannel")}}a(null,e)}.bind(this))},setTextureQuality:function(t,e){var a=this._getFeatureModel("quality");a.get("promiseReady").then(function(n){var o={ld:0,sd:1,hd:2};if(n.high||(o={ld:0,hd:1}),n.mid||(o={hd:0}),t in o){var r=o[t];a.set("level",r),e(null,"texture quality set to "+r)}else{var s=Object(i.map)(o,function(t,e){return e}).join(", ");e(['Quality must be a string "ld", "sd" or "hd".'," Available qualities for this model are : ",s].join(""),null)}}.bind(this))},setMaterial:function(t,e){var a=this._getFeatureModel("material"),n=t.stateSetID,i=a.getMaterialByStateSetID(n);i.setMaterialJSON(t,a.getImageCollection(),{validate:!0,warnOnError:!0}),i.trigger("apply"),s.a.redrawShadow(),e(null)},setPostProcessing:function(t,e){this._getFeatureModel("postProcess").set(t),e(null)},getPostProcessing:function(t){t(this._getFeatureModel("postProcess").toJSON())},getWorldToScreenCoordinates:function(t,e){var a=c.a.getScreenPositionFromWorldPoint(t);e({glCoord:a.slice(0,2),canvasCoord:u.a.glCoordToCanvas(a[0],a[1],a).slice(0,2)})}},e.a=g},849:function(t,e,a){"use strict";a.d(e,"b",function(){return r}),a.d(e,"c",function(){return l}),a.d(e,"a",function(){return d});var n=a(47),i=a(8),o=i.a.osg,r=function(t){this._translateUpdateCallbackListPerNode={},this._rotateUpdateCallbackListPerNode={},this._nodeList=t};r.prototype={addTranslateUpdateCallback:function(t,e,a){var n=this._translateUpdateCallbackListPerNode[a];n&&(o.mat4.setTranslation(t.getMatrix(),n._target),e._source=n._target),this._translateUpdateCallbackListPerNode[a]=e},addRotateUpdateCallback:function(t,e,a){var n=this._rotateUpdateCallbackListPerNode[a];if(n){var i=n._target,r=o.mat4.create(),s=o.vec3.create();o.mat4.fromQuat(r,i),o.mat4.getTranslation(s,t.getMatrix()),o.mat4.setTranslation(r,s),o.mat4.copy(t.getMatrix(),r),e._source=n._target}this._rotateUpdateCallbackListPerNode[a]=e},removeTranslateUpdateCallback:function(t){delete this._translateUpdateCallbackListPerNode[t]},removeRotateUpdateCallback:function(t){delete this._rotateUpdateCallbackListPerNode[t]},update:function(t,e){var a,n,i;for(n in this._rotateUpdateCallbackListPerNode)a=this._rotateUpdateCallbackListPerNode[n],i=this._nodeList[n],a.update(i,e);for(n in this._translateUpdateCallbackListPerNode)a=this._translateUpdateCallbackListPerNode[n],i=this._nodeList[n],a.update(i,e);return!0}};var s=function(t,e,a,n,i){this._source=t,this._target=e,this._duration=a,this._started=-1,this._easing=n,this._finished=!1,this._callback=i};s.prototype={isFinished:function(){return this._finished},update:function(t,e){if(this._finished)return!0;n.a.redrawShadow();var a=e.getFrameStamp().getSimulationTime();this._started<0&&(this._started=a);var i=(a-this._started)/this._duration;return i>1&&(this._finished=!0,this._callback&&this._callback(this._result),i=1),this._easing&&(i=this._easing(i)),this.interpolate(i,t),!0}};var l=function(t,e,a,n,i){s.call(this,t,e,a,n,i),this._result=o.vec3.create()};l.prototype=o.objectInherit(s.prototype,{interpolate:function(t,e){o.vec3.lerp(this._result,this._source,this._target,t),o.mat4.setTranslation(e.getMatrix(),this._result),e.dirtyBound()}});var d=function(t,e,a,n,i){s.call(this,t,e,a,n,i),this._result=o.quat.create(),this._translate=o.vec3.create(),this._finalResult=o.mat4.create()};d.prototype=o.objectInherit(s.prototype,{interpolate:function(t,e){o.quat.slerp(this._result,this._source,this._target,t),o.mat4.getTranslation(this._translate,e.getMatrix()),o.mat4.fromQuat(this._finalResult,this._result),o.mat4.setTranslation(this._finalResult,this._translate),o.mat4.copy(e.getMatrix(),this._finalResult),e.dirtyBound()}})},850:function(t,e,a){"use strict";var n=a(427),i=a.n(n),o=a(8),r=a(150),s=a(189),l=a(69),d=a(115),c=a(107),u=a(50),h=a(848),p=a(47),g=a(0),f=(a.n(g),o.a.osg),m=function(){h.a.apply(this,arguments),this._displayed=!1,u.a.getModelDisplayed().then(function(){this._displayed=!0}.bind(this)),this._pickMask={click:l.a.PICK_GEOMETRY_FAST,mousemove:l.a.PICK_GEOMETRY_FAST}};m.prototype=Object(g.create)(h.a.prototype,{addGlobalListener:function(t){c.a.getBoxReady().then(function(){s.a.initViewerAPI(this),this._getViewer().getInputManager().setEnable(d.a.SCENE_VIEWERAPI,!0)}.bind(this)),this._replayEmitter.subscribe(t)},intersectPoint:void 0,_emitEvents:function(){var t={viewerready:"viewerready",started:"viewerstart",stopped:"viewerstop",annotationFocus:"annotationFocus",annotationBlur:"annotationBlur",annotationMouseEnter:"annotationMouseEnter",annotationMouseLeave:"annotationMouseLeave",annotationSelect:"annotationSelect",nodeMouseEnter:"nodeMouseEnter",nodeMouseLeave:"nodeMouseLeave",click:"click",cameraStart:"camerastart",cameraStop:"camerastop"},e=function(e,a){var n=t[e];n&&this._replayEmitter.emit(n,a)}.bind(this);this._partial.on("all",e),this._partial.scene.on("all",e),this._emitEvents=function(){}},onCursorUp:function(){var t=f.vec3.create(),e=f.vec3.create(),a=f.vec2.create();return function(n){if(this._displayed){a[0]=n.canvasX,a[1]=n.canvasY;var i=r.a.computeNearestIntersection2D(a[0],a[1],this._pickMask.click),o={position3D:null,position2D:a,normal:null,instanceID:null,material:null};if(!i)return void this._replayEmitter.emit("click",o);r.a.getWorldPositionFromHit(i,e,t);var s=this._getFeatureModel("material").findFirstMaterial(i._nodePath);o.normal=t,o.position3D=e,o.instanceID=i._nodePath[i._nodePath.length-1].getInstanceID(),o.material=s?s.getJSON():null,this._replayEmitter.emit("click",o)}}}(),onMouseMove:function(){var t,e,a=f.vec3.create(),n=f.vec3.create(),i=f.vec2.create();return function(o){if(this._displayed){i[0]=o.canvasX,i[1]=o.canvasY;var s=r.a.computeNearestIntersection2D(i[0],i[1],this._pickMask.click);if(s){r.a.getWorldPositionFromHit(s,n,a);var l=s._nodePath[s._nodePath.length-1].getInstanceID(),d=this._getFeatureModel("material"),c=d.findFirstMaterial(s._nodePath);if(e===l)return;return e&&this._replayEmitter.emit("nodeMouseLeave",{position3D:null,position2D:null,normal:a,instanceID:e,material:t}),e=l,t=c?c.getJSON():null,void this._replayEmitter.emit("nodeMouseEnter",{position3D:n,position2D:i,normal:a,instanceID:e,material:t})}e&&(this._replayEmitter.emit("nodeMouseLeave",{position3D:n,position2D:i,normal:a,instanceID:e,material:t}),e=void 0,t=void 0)}}}(),setListenerOptions:function(t){if(t&&"function"!=typeof t)switch(t.name){case"click":this._pickMask.click="slow"===t.pick?l.a.PICK_GEOMETRY_SLOW:l.a.PICK_GEOMETRY_FAST;break;case"nodeMouseEnter":case"nodeMouseLeave":this._pickMask.mousemove="slow"===t.pick?l.a.PICK_GEOMETRY_SLOW:l.a.PICK_GEOMETRY_FAST}},pickColor:function(){var t=new Uint8Array(4);return function(e,a){new i.a(function(a,n){var i=this._getViewerOSG().getCamera();i.setFinalDrawCallback(function(o){var r=o.getGraphicContext();if(r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE)return void n();r.flush(),r.finish();var s=e[0]*(r.drawingBufferWidth/r.canvas.clientWidth),l=r.drawingBufferHeight*(1-e[1]/r.canvas.clientHeight);r.readPixels(s,l,1,1,r.RGBA,r.UNSIGNED_BYTE,t),a(t),i.setFinalDrawCallback(void 0)})}.bind(this)).then(function(){a(t)})}}(),unselectAnnotation:function(t){this.gotoAnnotation(-1,t)},requestRedraw:function(){p.a.redrawShadow()}}),e.a=m}},[1686])});
//# sourceMappingURL=standaloneViewer-b65c89a4aae026d230e9.js.map